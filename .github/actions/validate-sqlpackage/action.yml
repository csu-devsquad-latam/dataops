name: 'Validating package changes'
description: 'Validates the changes analyzed by a SqlPackage'
inputs:
  environment:
    description: 'Environment identifier to include in the report'
    required: true
    default: 'dev'
  sqlpackage-report:
    description: 'The filepath of the report generated by SqlPackage. It has extension XML'
    required: true
  outputpath:
    description: 'The output folder where assets will be generated if any'
    required: false
    default: .
  outputfile:
    description: 'The output file name, with extension MD'
    default: 'deployreport.MD'
  haltonerrors:
    description: 'If the action should fail when validation errors are found'
    default: true
runs:
  using: "composite"
  steps:
    - name: Validating proposed changes
      shell: pwsh
      run: |
        ${{ github.workspace }}/.github/actions/validate-sqlpackage/Parse-SqlProfileReport.ps1  `
          -Environment "${{ inputs.environment }}"  `
          -SqlPackageReport "${{ inputs.sqlpackage-report }}"  `
          -OutputFilePath "${{ inputs.outputpath }}/${{ inputs.outputfile }}"  `
          -HaltOnDataIssues ${{ '$' }}${{ inputs.haltonerrors }}
